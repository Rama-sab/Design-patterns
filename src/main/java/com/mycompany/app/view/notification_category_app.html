<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Notification & Category App</title>
  <style>
    /* (All CSS stays the same as your previous code) */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Inter', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .container {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 2rem;
      box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
      width: 90%;
      max-width: 500px;
      transition: all 0.3s ease;
    }
    .page { display: none; }
    .page.active { display: block; animation: fadeIn 0.5s ease; }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    h1 {
      color: #2d3748; margin-bottom: 1.5rem; text-align: center;
      font-size: 2rem; font-weight: 700;
    }
    .notifications-list {
      max-height: 400px; overflow-y: auto;
      margin-bottom: 1.5rem; padding-right: 0.5rem;
    }
    .notification-item {
      background: rgba(255, 255, 255, 0.9);
      border: 1px solid #e2e8f0;
      border-radius: 12px;
      padding: 1rem;
      margin-bottom: 0.75rem;
      transition: all 0.3s ease;
    }
    .notification-item:hover {
      transform: translateX(5px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      border-color: #667eea;
    }
    .message { font-size: 1rem; color: #2d3748; line-height: 1.4; }
    .empty-state {
      text-align: center; color: #6b7280;
      padding: 2rem; font-style: italic;
    }
    .btn {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white; border: none;
      padding: 1rem 2rem;
      border-radius: 12px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      width: 100%; margin-bottom: 1rem;
    }
    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
    }
    .btn.secondary {
      background: #6b7280;
    }
    .notification {
      position: fixed; bottom: 20px; right: 20px;
      background: #4ade80; color: white;
      padding: 1rem 1.5rem;
      border-radius: 12px;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
      transform: translateX(400px);
      transition: all 0.3s ease;
      font-weight: 500; z-index: 1000;
    }
    .notification.show { transform: translateX(0); }
    .notification.error { background: #ef4444; }
    .category-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 1.5rem;
      margin-bottom: 2rem;
    }
    .category-item {
      background: white;
      border: 2px solid #e5e7eb;
      border-radius: 16px;
      padding: 1.2rem;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .category-item:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
      border-color: #667eea;
    }
    .category-item.selected {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white; border-color: #667eea;
    }
    .category-item .icon {
      font-size: 2rem;
      margin-bottom: 0.75rem;
    }
    .category-item h3 {
      font-size: 1.1rem;
      font-weight: bold;
      color: #111827;
      margin-bottom: 0.4rem;
    }
    .category-item p {
      font-size: 0.9rem;
      color: #6b7280;
    }
    .selected-count {
      text-align: center;
      margin-bottom: 1rem;
      padding: 0.75rem;
      background: #eef2ff;
      border-radius: 8px;
      color: #4c51bf;
      font-weight: 600;
      font-size: 1rem;
    }
    /* Add Event and Admin controls */
    .form-group { margin-bottom: 1.5rem; }
    .form-group label {
      display: block;
      font-weight: 600;
      color: #4a5568;
      margin-bottom: 0.5rem;
    }
    .form-group input[type="text"] {
      width: 100%;
      padding: 0.75rem;
      border: 1px solid #cbd5e0;
      border-radius: 8px;
      font-size: 1rem;
    }
    .category-radio-group { max-height: 200px; overflow-y: auto; padding: 0.5rem; border: 1px solid #e2e8f0; border-radius: 8px; }
    .radio-label {
      display: block;
      padding: 0.75rem;
      border-radius: 6px;
      margin-bottom: 0.5rem;
      cursor: pointer;
      transition: background-color 0.2s ease;
    }
    .radio-label:hover { background-color: #f7fafc; }
    .radio-label input { margin-right: 0.75rem; }
    .admin-controls { display: flex; gap: 0.5rem; margin-bottom: 1rem; flex-wrap: wrap; }
    .admin-controls .btn { width: auto; flex-grow: 1; padding: 0.75rem 1rem; }
    .category-group details {
      background: #f9fafb;
      border: 1px solid #e2e8f0;
      border-radius: 12px;
      margin-bottom: 1rem;
    }
    .category-group summary {
      padding: 1rem;
      font-weight: bold;
      cursor: pointer;
      font-size: 1.1rem;
      color: #1f2937;
    }
  </style>
</head>
<body>
  <div class="container" id="roleSelection">
    <h1>Select Role</h1>
    <button class="btn" onclick="selectRole('user')">üë§ Normal User</button>
    <button class="btn" onclick="selectRole('admin')">üõ†Ô∏è Admin</button>
  </div>

  <div class="container" id="mainApp" style="display:none;">
    <div class="page active" id="notificationPage">
      <h1>üì¢ Notifications</h1>
      <div class="notifications-list" id="notificationsList"></div>
      <button class="btn" onclick="showCategoryPage()">Manage Categories ‚Üí</button>
      <button class="btn" onclick="showAddEventPage()">‚ûï Add Event</button>
      <button class="btn" id="toAllEventsBtn" onclick="showAllEventsPage()" style="display:none;">üìã All Events (Admin)</button>
      <button class="btn secondary" onclick="goToMainPage()">‚Üê Back to Role Selection</button>
    </div>

    <div class="page" id="categoryPage">
      <h1>üè∑Ô∏è Select Categories</h1>
      <div class="selected-count" id="selectedCount">0 categories selected</div>
      <div class="category-grid" id="categoryGrid"></div>
      <button class="btn" onclick="submitCategories()">Submit Selected Categories</button>
      <button class="btn secondary" onclick="showNotificationPage()">‚Üê Back to Notifications</button>
      <button class="btn" onclick="goToMainPage()">‚Üê Back to Main Page</button>
    </div>

    <div class="page" id="addEventPage">
      <h1>‚ûï Add New Event</h1>
      <div class="form-group">
        <label for="eventMessage">Event Message</label>
        <input type="text" id="eventMessage" placeholder="Enter your event details...">
      </div>
      <div class="form-group">
        <label>Select a Category</label>
        <div class="category-radio-group" id="eventCategoryList"></div>
      </div>
      <button class="btn" onclick="submitNewEvent()">Submit Event</button>
      <button class="btn secondary" onclick="showNotificationPage()">‚Üê Cancel</button>
    </div>

    <div class="page" id="allEventsPage">
      <h1>üìã All Events (Admin)</h1>
      <div class="admin-controls">
        <button class="btn" onclick="sortAllEventsByDate()">Sort by Date</button>
        <button class="btn" onclick="groupAllEventsByCategory()">Group by Category</button>
        <button class="btn secondary" onclick="renderAllEvents()">Reset View</button>
      </div>
      <div class="notifications-list" id="allEventsList"></div>
      <button class="btn" onclick="showAddEventPage()">‚ûï Add Event</button>
      <button class="btn secondary" onclick="showNotificationPage()">‚Üê Back to Notifications</button>
      <button class="btn" onclick="goToMainPage()">‚Üê Back to Main Page</button>
    </div>
  </div>

  <div class="notification" id="notificationToast"></div>

  <script>
    const categories = [
      { id: 0, name: 'Alert', icon: 'üîî', desc: 'No specific category' },
      { id: 1, name: 'Technology', icon: 'üíª', desc: 'Tech news & updates' },
      { id: 2, name: 'Sports', icon: '‚öΩ', desc: 'Sports & games' },
      { id: 3, name: 'Food', icon: 'üçï', desc: 'Recipes & restaurants' },
      { id: 4, name: 'Travel', icon: '‚úàÔ∏è', desc: 'Travel guides & tips' },
      { id: 5, name: 'Music', icon: 'üéµ', desc: 'Music & concerts' },
      { id: 6, name: 'Movies', icon: 'üé¨', desc: 'Films & entertainment' },
      { id: 7, name: 'Fashion', icon: 'üëó', desc: 'Style & trends' },
      { id: 8, name: 'Health', icon: 'üí™', desc: 'Fitness & wellness' }
    ];
    let notifications = [];
    let eventsadd = [];
    let selectedCategories = [];
    let currentRole = null;

    function selectRole(role) {
      currentRole = role;
      document.getElementById('roleSelection').style.display = 'none';
      document.getElementById('mainApp').style.display = 'block';

      document.getElementById('toAllEventsBtn').style.display = role === 'admin' ? 'block' : 'none';
      showPage('notificationPage');
      renderNotifications();
    }

    function showPage(pageId) {
      document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
      document.getElementById(pageId).classList.add('active');
    }

    function goToMainPage() {
      currentRole = null;
      document.getElementById('mainApp').style.display = 'none';
      document.getElementById('roleSelection').style.display = 'block';
    }

    function showNotificationPage() { showPage('notificationPage'); }
    function showCategoryPage() { showPage('categoryPage'); renderCategories(); }
    function showAddEventPage() { showPage('addEventPage'); renderEventCategoryList(); }

    function showAllEventsPage() {
      if (currentRole !== 'admin') return;
      showPage('allEventsPage');
      renderAllEvents();
    }

    function showNotification(message, type = 'success') {
      const toast = document.getElementById('notificationToast');
      toast.textContent = message;
      toast.className = `notification ${type} show`;
      setTimeout(() => { toast.classList.remove('show'); }, 3000);
    }

    function getFormattedDateTime() {
      const now = new Date();
      const date = now.toLocaleDateString();
      const time = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
      return { date, time, timestamp: now.getTime() };
    }

    // Show ALL notifications/events
    function renderNotifications() {
      const container = document.getElementById('notificationsList');
      const all = [...notifications].reverse();
      container.innerHTML = all.length === 0
        ? '<div class="empty-state">No notifications yet</div>'
        : all.map(n => renderNotificationItem(n)).join('');
    }

    function renderAllEvents(eventList = notifications) {
      const container = document.getElementById('allEventsList');
      const all = [...eventList].reverse();
      container.innerHTML = all.length === 0
        ? '<div class="empty-state">No events available</div>'
        : all.map(n => renderNotificationItem(n)).join('');
    }

    function renderNotificationItem(n) {
      const category = categories.find(c => c.id === n.categoryId) || categories[0];
      return `<div class="notification-item">
        <div class="message">
          ${n.message}
          <div style="font-size: 0.85rem; color: gray; margin-top: 5px;">
            ${category.icon} ${category.name} | üïí ${n.date} ${n.time}
          </div>
        </div>
      </div>`;
    }

    function renderCategories() {
      const grid = document.getElementById('categoryGrid');
      grid.innerHTML = '';
      categories.forEach(category => {
        const isSelected = selectedCategories.includes(category.id);
        const item = document.createElement('div');
        item.className = `category-item ${isSelected ? 'selected' : ''}`;
        item.onclick = () => toggleCategory(category.id);
        item.innerHTML = `<span class="icon">${category.icon}</span><h3>${category.name}</h3><p>${category.desc}</p>`;
        grid.appendChild(item);
      });
      updateSelectedCount();
    }

    function toggleCategory(categoryId) {
      const index = selectedCategories.indexOf(categoryId);
      if (index > -1) selectedCategories.splice(index, 1);
      else selectedCategories.push(categoryId);
      renderCategories();
      const category = categories.find(c => c.id === categoryId);
      const action = selectedCategories.includes(categoryId) ? 'selected' : 'deselected';
      showNotification(`${category.name} ${action}!`);
    }

    function updateSelectedCount() {
      document.getElementById('selectedCount').textContent = `${selectedCategories.length} categories selected`;
    }

    function submitCategories() {
      if (selectedCategories.length === 0) return showNotification('Please select at least one category!', 'error');
      const selectedNames = selectedCategories.map(id => categories.find(c => c.id === id).name).join(', ');
      showNotification(`Categories submitted: ${selectedNames}`);
      showNotificationPage();
    }

    function renderEventCategoryList() {
      const container = document.getElementById('eventCategoryList');
      container.innerHTML = categories.map(cat => `
        <label class="radio-label">
          <input type="radio" name="eventCategory" value="${cat.id}">
          ${cat.icon} ${cat.name}
        </label>
      `).join('');
    }

   function submitNewEvent() {
  const messageInput = document.getElementById('eventMessage');
  const message = messageInput.value.trim();
  const selectedCategoryInput = document.querySelector('input[name="eventCategory"]:checked');

  if (!message) {
    return showNotification('Please enter an event message!', 'error');
  }
  if (!selectedCategoryInput) {
    return showNotification('Please select a category!', 'error');
  }

  const { date, time, timestamp } = getFormattedDateTime();
 const newEvent = {
  name: message,
  categoryId: parseInt(selectedCategoryInput.value)
};


  notifications.push({
    ...newEvent, date, time, timestamp // for frontend display only
  });

  renderNotifications();
  if (currentRole === 'admin') renderAllEvents();

  messageInput.value = '';
  selectedCategoryInput.checked = false;

  showNotification('Event added successfully!');
  showNotificationPage();

  
  fetch('http://localhost:8080/api/addevent', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(newEvent)
  })
  .then(response => {
    if (!response.ok) throw new Error('Failed to send to backend');
    console.log('‚úÖ Event sent to backend successfully');
  })
  .catch(error => {
    console.error('‚ùå Error sending event to backend:', error);
    showNotification('Failed to send event to backend!', 'error');
  });
}


    function sortAllEventsByDate() {
      const sortedEvents = [...notifications].sort((a, b) => b.timestamp - a.timestamp);
      renderAllEvents(sortedEvents);
    }

    function groupAllEventsByCategory() {
      const container = document.getElementById('allEventsList');
      const groupedEvents = notifications.reduce((acc, event) => {
        (acc[event.categoryId] = acc[event.categoryId] || []).push(event);
        return acc;
      }, {});

      const sortedCategoryIds = Object.keys(groupedEvents).sort((a, b) => a - b);

      if (sortedCategoryIds.length === 0) {
        container.innerHTML = '<div class="empty-state">No events available to group</div>';
        return;
      }

      container.innerHTML = sortedCategoryIds.map(categoryId => {
        const category = categories.find(c => c.id == categoryId) || categories[0];
        const eventsInCategory = groupedEvents[categoryId];
        eventsInCategory.sort((a, b) => b.timestamp - a.timestamp);

        return `
          <details class="category-group" open>
            <summary>${category.icon} ${category.name} (${eventsInCategory.length})</summary>
            ${eventsInCategory.map(event => renderNotificationItem(event)).join('')}
          </details>
        `;
      }).join('');
    }

    function fetchNotificationsFromBackend() {
      fetch('http://localhost:8080/api/notifications')
        .then(res => res.json())
        .then(data => {
          notifications = data;
          renderNotifications();
          if (currentRole === 'admin') renderAllEvents();
        })
        .catch(() => {
          document.getElementById('notificationsList').innerHTML = '<div class="empty-state">Failed to load notifications</div>';
        });
    }

    document.addEventListener('DOMContentLoaded', () => {
      document.getElementById('mainApp').style.display = 'none';
      document.getElementById('roleSelection').style.display = 'block';
      fetchNotificationsFromBackend();
      //setInterval(fetchNotificationsFromBackend, 5000);
    });
  </script>
</body>
</html>
